<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;500;700&family=Hind:wght@400;500;700&display=swap" rel="stylesheet" />

    <title>React App</title>
    <!-- Pre-React Route Protection: Blocks engineers from interior dashboard BEFORE React loads -->
    <script>
      (function() {
        // This runs IMMEDIATELY when the page loads, before React mounts
        console.log("ğŸ” Pre-React Route Protection: Checking current path");
        const currentPath = window.location.pathname;
        
        // Only check if accessing interior dashboard
        if (currentPath === "/interior-dashboard" || currentPath.startsWith("/interior-dashboard")) {
          console.log("ğŸš¨ Accessing /interior-dashboard - Checking role BEFORE React loads");
          
          try {
            const savedUser = localStorage.getItem('user');
            if (savedUser) {
              const userData = JSON.parse(savedUser);
              const userRole = userData?.role;
              
              console.log("ğŸ” Pre-React Check - Role:", userRole, "User data:", userData);
              
              // Block engineers immediately
              if (userRole === "engineer") {
                console.log("ğŸš«ğŸš«ğŸš« Pre-React: Engineer BLOCKED - FORCING redirect to /engineer-dashboard");
                window.location.replace("/engineer-dashboard");
                return;
              }
              
              // Block admins
              if (userRole === "admin") {
                console.log("ğŸš« Pre-React: Admin BLOCKED - redirecting to /admin-dashboard");
                window.location.replace("/admin-dashboard");
                return;
              }
              
              // Block customers
              if (userRole === "customer") {
                console.log("ğŸš« Pre-React: Customer BLOCKED - redirecting to /customer-dashboard");
                window.location.replace("/customer-dashboard");
                return;
              }
              
              // Only allow interior designers
              if (userRole && userRole !== "interiorDesigner" && userRole !== "interior") {
                console.log("ğŸš« Pre-React: Role '" + userRole + "' BLOCKED - redirecting to home");
                window.location.replace("/");
                return;
              }
              
              console.log("âœ… Pre-React: User is an interior designer - allowing access");
            } else {
              console.log("ğŸš« Pre-React: No user logged in - redirecting to /auth");
              window.location.replace("/auth");
            }
          } catch (error) {
            console.error("âŒ Pre-React: Error checking role:", error);
          }
        }
        
        // Also intercept navigation events
        const originalPushState = history.pushState;
        const originalReplaceState = history.replaceState;
        
        function checkRouteAndRedirect(path) {
          if (path && (path === "/interior-dashboard" || path.startsWith("/interior-dashboard"))) {
            try {
              const savedUser = localStorage.getItem('user');
              if (savedUser) {
                const userData = JSON.parse(savedUser);
                const userRole = userData?.role;
                
                if (userRole === "engineer") {
                  console.log("ğŸš« Intercepted navigation to /interior-dashboard - Engineer blocked");
                  window.location.replace("/engineer-dashboard");
                  return true; // Prevent navigation
                }
              }
            } catch (e) {
              console.error("Error in navigation check:", e);
            }
          }
          return false;
        }
        
        history.pushState = function() {
          if (!checkRouteAndRedirect(arguments[2])) {
            originalPushState.apply(history, arguments);
          }
        };
        
        history.replaceState = function() {
          if (!checkRouteAndRedirect(arguments[2])) {
            originalReplaceState.apply(history, arguments);
          }
        };
        
        window.addEventListener("popstate", function() {
          checkRouteAndRedirect(window.location.pathname);
        });
      })();
    </script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
  </body>
</html>

